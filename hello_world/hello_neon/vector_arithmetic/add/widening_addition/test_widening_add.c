// 2023-04-14 18:03
#include <neon.h>

/* NOTE: addl_s8 表示 add 两个 s8 结果为 s16, 其中的 l 后缀表示 long, 支持
 * {s,u}{8,16,32}, 不支持 {s,u}64, 因为输出的长度会乘 2. 没有 q 后缀, 因为输入一
 * 定是 64-bit vector, 输出一定是 128-bit vector */
TEST_CASE(test_vaddl_s8) {
    struct {
        int8_t a[8];
        int8_t b[8];
        int16_t r[8];
    } test_vec[] = {
        {{-101, 70, 78, 35, 52, -115, -75, 9},
         {-7, -86, 92, 121, 108, 119, 71, -69},
         {-108, -16, 170, 156, 160, 4, -4, -60}},
        {{84, -56, 30, 53, 70, 95, 116, 23},
         {117, 73, 119, -6, -59, -46, 109, 96},
         {201, 17, 149, 47, 11, 49, 225, 119}},
        {{24, -69, -124, 76, 72, 57, 86, 65},
         {-28, -78, -70, 80, 42, 2, 11, 126},
         {-4, -147, -194, 156, 114, 59, 97, 191}},
        {{-54, 42, -77, 16, -119, 40, 39, -2},
         {113, -97, -8, 55, 113, 101, -105, -119},
         {59, -55, -85, 71, -6, 141, -66, -121}},
        {{32, 27, -42, 105, 85, 44, -86, 57},
         {-34, 101, -119, 8, 103, -108, -122, 49},
         {-2, 128, -161, 113, 188, -64, -208, 106}},
        {{-66, 58, 65, 71, 98, 105, 69, -45},
         {8, 62, 10, 121, -93, -94, 2, -60},
         {-58, 120, 75, 192, 5, 11, 71, -105}},
        {{-67, -40, 45, 18, 4, -41, 75, -29},
         {60, -44, -21, -93, 105, 114, -44, 39},
         {-7, -84, 24, -75, 109, 73, 31, 10}},
        {{-84, 22, 111, 14, INT8_MAX, -76, -31, -121},
         {-14, -20, 0, -106, -114, 2, 90, 75},
         {-98, 2, 111, -92, 13, -74, 59, -46}},
    };

    for (size_t i = 0; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
        int8x8_t a = vld1_s8(test_vec[i].a);
        int8x8_t b = vld1_s8(test_vec[i].b);
        int16x8_t r = vaddl_s8(a, b);
        int16x8_t check = vld1q_s16(test_vec[i].r);
        ASSERT_EQUAL(8, r, check);
    }

    return 0;
}
